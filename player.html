<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Varun‚Äôs GitHub Crossfade Audio Player</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
  :root {
    --color1: #ff6f61;
    --color2: #f7d794;
    --color3: #778beb;
    --color4: #e77f67;
    --color5: #f8a5c2;
  }
  body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(270deg, #ff6f61, #f7d794, #778beb, #e77f67, #f8a5c2);
  background-size: 1000% 1000%;
  animation: gradientShift 30s ease infinite;
  color: white;
  margin: 0;
  padding: 2rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}
  h1 {
    margin-bottom: 0.2rem;
  }
  #player-container {
    background: rgba(255 255 255 / 0.1);
    border-radius: 16px;
    padding: 1rem 2rem;
    width: 100%;
    max-width: 600px;
    box-shadow: 0 0 30px rgba(0,0,0,0.3);
  }
  #playlist {
    margin-top: 1.5rem;
    max-height: 300px;
    overflow-y: auto;
    border-radius: 12px;
    background: rgba(255 255 255 / 0.05);
    padding: 0.5rem;
  }
  #playlist div {
    padding: 0.5rem 1rem;
    cursor: pointer;
    border-radius: 8px;
  }
  #playlist div:hover {
    background: var(--color5);
    color: #111;
  }
  #playlist .active {
    background: var(--color4);
    font-weight: 600;
    color: #111;
  }
  button {
    background: var(--color5);
    border: none;
    border-radius: 50%;
    padding: 0.6rem 0.75rem;
    margin: 0 0.5rem;
    cursor: pointer;
    font-size: 1.3rem;
    color: #111;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    transition: background 0.3s;
  }
  button:hover {
    background: var(--color1);
    color: white;
  }
  #controls {
    margin-top: 1rem;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #seekbar {
    width: 100%;
    margin: 1rem 0;
  }
  input[type=range] {
    width: 100%;
    -webkit-appearance: none;
    height: 6px;
    border-radius: 3px;
    background: linear-gradient(to right, var(--color2), var(--color3));
    outline: none;
    cursor: pointer;
  }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    background: var(--color4);
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 5px rgba(0,0,0,0.3);
  }
</style>
</head>
<body>

<h1>Varun‚Äôs Crossfade Audio Player</h1>

<div id="player-container">
  <!-- Two audio elements for crossfade -->
  <audio id="audio1" preload="auto" crossorigin="anonymous"></audio>
  <audio id="audio2" preload="auto" crossorigin="anonymous"></audio>

  <div id="controls">
    <button id="prev" title="Previous">‚èÆÔ∏è</button>
    <button id="play-pause" title="Play/Pause">‚ñ∂Ô∏è</button>
    <button id="next" title="Next">‚è≠Ô∏è</button>
    <button id="loop-btn" title="Loop Mode">üîÅ</button>
    <button id="shuffle-btn" title="Shuffle">üîÄ</button>
  </div>

  <input type="range" id="seekbar" value="0" min="0" max="100" step="0.1" />

  <div id="playlist">Loading media...</div>
</div>

<script>
(() => {
  const username = "varun1210163";
  const repo = "music";

  const audio1 = document.getElementById("audio1");
  const audio2 = document.getElementById("audio2");
  const playPauseBtn = document.getElementById("play-pause");
  const prevBtn = document.getElementById("prev");
  const nextBtn = document.getElementById("next");
  const loopBtn = document.getElementById("loop-btn");
  const shuffleBtn = document.getElementById("shuffle-btn");
  const seekbar = document.getElementById("seekbar");
  const playlistDiv = document.getElementById("playlist");

  let audioNodes = [audio1, audio2];
  let currentAudio = 0; // index of active audio element
  let isPlaying = false;

  // Loop modes: 0=loop off,1=loop all,2=loop one,3=shuffle
  let loopMode = 0;
  let shuffle = false;

  let tracks = [];
  let currentIndex = 0;

  // Fade config
  const fadeTime = 2; // seconds
  const fadeInterval = 50; // ms

  // Crossfade function: fade out old, fade in new
  function crossfadeToTrack(index) {
    if (index < 0 || index >= tracks.length) return;

    let nextAudio = 1 - currentAudio;
    let oldAudio = currentAudio;

    const nextTrack = tracks[index];
    let volumeStep = 1 / (fadeTime * 1000 / fadeInterval);
    let fadeOutVol = 1;
    let fadeInVol = 0;

    // Prepare next audio element
    audioNodes[nextAudio].src = nextTrack.download_url;
    audioNodes[nextAudio].currentTime = 0;
    audioNodes[nextAudio].volume = 0;
    audioNodes[nextAudio].play();

    // Start fading
    const fadeTimer = setInterval(() => {
      fadeOutVol -= volumeStep;
      fadeInVol += volumeStep;
      if (fadeOutVol <= 0) {
        fadeOutVol = 0;
        fadeInVol = 1;
        clearInterval(fadeTimer);
        audioNodes[oldAudio].pause();
        audioNodes[oldAudio].src = "";
      }
      audioNodes[oldAudio].volume = fadeOutVol;
      audioNodes[nextAudio].volume = fadeInVol;
    }, fadeInterval);

    currentAudio = nextAudio;
    currentIndex = index;
    highlightActiveTrack();

    isPlaying = true;
    playPauseBtn.textContent = "‚èØÔ∏è";
  }

  // Highlight the current track in the playlist
  function highlightActiveTrack() {
    const items = playlistDiv.querySelectorAll("div");
    items.forEach((item, i) => {
      if(i === currentIndex) item.classList.add("active");
      else item.classList.remove("active");
    });
  }

  // Play/pause toggle
  function togglePlayPause() {
    if (isPlaying) {
      audioNodes[currentAudio].pause();
      playPauseBtn.textContent = "‚ñ∂Ô∏è";
      isPlaying = false;
    } else {
      audioNodes[currentAudio].play();
      playPauseBtn.textContent = "‚èØÔ∏è";
      isPlaying = true;
    }
  }

  // Next track logic with loop/shuffle
  function nextTrack() {
    if (shuffle) {
      let nextIdx;
      do {
        nextIdx = Math.floor(Math.random() * tracks.length);
      } while (nextIdx === currentIndex && tracks.length > 1);
      crossfadeToTrack(nextIdx);
    } else {
      if (loopMode === 2) { // Loop one
        crossfadeToTrack(currentIndex);
      } else {
        let nextIdx = currentIndex + 1;
        if (nextIdx >= tracks.length) {
          if (loopMode === 1) nextIdx = 0; // Loop all
          else return pauseAndReset();
        }
        crossfadeToTrack(nextIdx);
      }
    }
  }

  // Previous track
  function prevTrack() {
    let prevIdx = currentIndex - 1;
    if (prevIdx < 0) prevIdx = tracks.length - 1;
    crossfadeToTrack(prevIdx);
  }

  // Pause and reset UI
  function pauseAndReset() {
    audioNodes[currentAudio].pause();
    playPauseBtn.textContent = "‚ñ∂Ô∏è";
    isPlaying = false;
  }

  // Update seekbar while playing
  function updateSeekbar() {
    const audio = audioNodes[currentAudio];
    if (!audio.duration) return;
    seekbar.max = audio.duration;
    seekbar.value = audio.currentTime;
  }

  // Seek audio position from slider
  seekbar.addEventListener("input", () => {
    audioNodes[currentAudio].currentTime = seekbar.value;
  });

  // Loop button cycle through modes
  loopBtn.addEventListener("click", () => {
    loopMode = (loopMode + 1) % 4; // 0-3
    shuffle = loopMode === 3;
    updateLoopButton();
  });

  function updateLoopButton() {
    switch(loopMode) {
      case 0: loopBtn.textContent = "üîÅ Off"; break;
      case 1: loopBtn.textContent = "üîÇ All"; break;
      case 2: loopBtn.textContent = "üîÇ One"; break;
      case 3: loopBtn.textContent = "üîÄ Shuffle"; break;
    }
  }
  updateLoopButton();

  // Shuffle button toggles shuffle mode
  shuffleBtn.addEventListener("click", () => {
    shuffle = !shuffle;
    loopMode = shuffle ? 3 : 0;
    updateLoopButton();
  });

  // Play/pause button
  playPauseBtn.addEventListener("click", togglePlayPause);
  prevBtn.addEventListener("click", prevTrack);
  nextBtn.addEventListener("click", nextTrack);

  // Automatically go to next track when current ends (no crossfade here)
  audio1.addEventListener("ended", () => {
    if (currentAudio === 0) nextTrack();
  });
  audio2.addEventListener("ended", () => {
    if (currentAudio === 1) nextTrack();
  });

  // Load playlist from GitHub API
  async function loadPlaylist() {
    playlistDiv.textContent = "Loading media...";
    try {
      const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/`;
      const res = await fetch(apiUrl);
      const data = await res.json();
      tracks = data.filter(f => /\.(mp3|mp4)$/i.test(f.name));

      if (tracks.length === 0) {
        playlistDiv.textContent = "No audio files found.";
        return;
      }

      playlistDiv.innerHTML = "";
      tracks.forEach((track, i) => {
        const div = document.createElement("div");
        div.textContent = track.name;
        div.addEventListener("click", () => {
          if (i !== currentIndex) crossfadeToTrack(i);
        });
        playlistDiv.appendChild(div);
      });

      // Start with first track
      crossfadeToTrack(0);
    } catch(e) {
      playlistDiv.textContent = "Failed to load playlist.";
      console.error(e);
    }
  }

  // Update seekbar on timeupdate
  function setupSeekbarUpdater() {
    audioNodes.forEach(audio => {
      audio.addEventListener("timeupdate", updateSeekbar);
    });
  }
  setupSeekbarUpdater();

  loadPlaylist();

  // Background color changer (slowly cycles colors)
  const colors = [
    '#ff6f61', '#f7d794', '#778beb', '#e77f67', '#f8a5c2'
  ];
  let colorIndex = 0;
  setInterval(() => {
    colorIndex = (colorIndex + 1) % colors.length;
    document.body.style.background = `linear-gradient(135deg, ${colors[colorIndex]}, ${colors[(colorIndex+1)%colors.length]})`;
  }, 10000);

})();
</script>

</body>
</html>
